<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة معلوماتك الشخصية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap');

        body { font-family: 'Tajawal', sans-serif; transition: all 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.5s ease forwards; }
        .card-item { animation: fadeIn 0.5s ease forwards; opacity: 0; }
        .card-item:nth-child(1) { animation-delay: 0.1s; }
        .card-item:nth-child(2) { animation-delay: 0.2s; }
        .card-item:nth-child(3) { animation-delay: 0.3s; }
        @keyframes spinner { to { transform: rotate(360deg); } }
        .spinner:before {
            content: ''; box-sizing: border-box; position: absolute; top: 50%; left: 50%;
            width: 30px; height: 30px; margin-top: -15px; margin-left: -15px;
            border-radius: 50%; border: 3px solid #ccc; border-top-color: #5D5CDE;
            animation: spinner .6s linear infinite;
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.05); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: rgba(93, 92, 222, 0.5); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(93, 92, 222, 0.7); }
        .stat-card { transition: all 0.3s ease; position: relative; overflow: hidden; z-index: 1; }
        .stat-card::before {
            content: ''; position: absolute; top: -10px; right: -10px;
            width: 40px; height: 40px; border-radius: 50%; background-color: rgba(93, 92, 222, 0.2); z-index: -1;
        }
        .stat-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 p-4 font-tajawal">
    <div class="max-w-4xl mx-auto bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 transition-all duration-300">
        <div class="flex items-center justify-center mb-6">
            <div class="animate-fadeIn">
                <h1 class="text-3xl md:text-4xl font-bold text-center bg-gradient-to-l from-primary to-secondary inline-block text-transparent bg-clip-text">لوحة معلوماتك الشخصية</h1>
                <p class="text-center text-gray-500 dark:text-gray-400 mt-2">إحصائيات وبيانات مخصصة على مدار حياتك</p>
            </div>
        </div>

        <div id="errorMessage" class="hidden mb-6 p-3 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 rounded-lg text-center"></div>

        <div id="formContainer" class="max-w-2xl mx-auto space-y-6 bg-gray-50 dark:bg-gray-700 p-6 rounded-xl shadow-sm">
            <div>
                <label for="name" class="block mb-2 font-medium text-lg">اسمك</label>
                <input type="text" id="name" placeholder="أدخل اسمك الكامل" 
                    class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary" required>
            </div>
            <div>
                <label for="hijriDate" class="block mb-2 font-medium text-lg">تاريخ ميلادك الهجري</label>
                <div class="flex flex-wrap md:flex-nowrap gap-2">
                    <select id="hijriDay" class="flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary" required>
                        <option value="">اليوم</option>
                    </select>
                    <select id="hijriMonth" class="flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary" required>
                        <option value="">الشهر</option>
                        <option value="1">محرّم</option>
                        <option value="2">صفر</option>
                        <option value="3">ربيع الأول</option>
                        <option value="4">ربيع الثاني</option>
                        <option value="5">جمادى الأولى</option>
                        <option value="6">جمادى الآخرة</option>
                        <option value="7">رجب</option>
                        <option value="8">شعبان</option>
                        <option value="9">رمضان</option>
                        <option value="10">شوال</option>
                        <option value="11">ذو القعدة</option>
                        <option value="12">ذو الحجة</option>
                    </select>
                    <select id="hijriYear" class="flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary" required>
                        <option value="">السنة</option>
                    </select>
                </div>
            </div>
            <div>
                <label for="team" class="block mb-2 font-medium text-lg">فريقك السعودي المفضل</label>
                <select id="team" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-primary focus:border-primary" required>
                    <option value="">اختر فريقك المفضل</option>
                    <option value="الهلال">الهلال</option>
                    <option value="النصر">النصر</option>
                    <option value="الاتحاد">الاتحاد</option>
                    <option value="الأهلي">الأهلي</option>
                </select>
            </div>
            <button id="saveBtn" class="w-full bg-gradient-to-l from-primary to-secondary hover:opacity-90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg transform hover:-translate-y-1">
                إنشاء لوحة المعلومات
            </button>
        </div>

        <div id="infoContainer" class="hidden">
            <div id="loadingState" class="relative h-40">
                <div class="spinner"></div>
            </div>
            <div id="dashboard" class="hidden">
                <div id="userHeader" class="flex flex-col md:flex-row items-center justify-between mb-8 bg-gray-50 dark:bg-gray-700 rounded-xl p-6 shadow-sm">
                    <div class="flex items-center mb-4 md:mb-0">
                        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white text-2xl font-bold mr-4">
                            <span id="userInitials"></span>
                        </div>
                        <div>
                            <h2 id="userName" class="text-2xl font-bold mb-1"></h2>
                            <p id="userBirthDate" class="text-gray-600 dark:text-gray-300"></p>
                        </div>
                    </div>
                    <div id="userTeamBadge" class="flex flex-col items-center">
                        <div id="teamLogo" class="w-12 h-12 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center mb-2">
                            <span id="teamInitial" class="text-xl font-bold"></span>
                        </div>
                        <p id="teamName" class="font-bold"></p>
                    </div>
                </div>
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <span class="w-7 h-7 rounded-full bg-primary flex items-center justify-center text-white text-sm ml-2">1</span>
                    إحصائيات عمرك
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="stat-card card-item bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-gray-700 dark:to-gray-800 p-4 rounded-xl shadow-sm">
                        <h4 class="text-primary dark:text-blue-300 font-bold mb-3">عمرك بالميلادي</h4>
                        <div class="flex items-end">
                            <span id="gregorianAge" class="text-3xl font-bold"></span>
                            <span class="text-gray-600 dark:text-gray-400 mr-1 mb-1">سنة</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">
                            <span id="gregorianMonths"></span> شهر و <span id="gregorianDays"></span> يوم
                        </div>
                    </div>
                    <div class="stat-card card-item bg-gradient-to-br from-green-50 to-teal-50 dark:from-gray-700 dark:to-gray-800 p-4 rounded-xl shadow-sm">
                        <h4 class="text-green-600 dark:text-green-300 font-bold mb-3">عمرك بالهجري</h4>
                        <div class="flex items-end">
                            <span id="hijriAge" class="text-3xl font-bold"></span>
                            <span class="text-gray-600 dark:text-gray-400 mr-1 mb-1">سنة</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">
                            <span id="hijriMonths"></span> شهر و <span id="hijriDays"></span> يوم
                        </div>
                    </div>
                </div>
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <span class="w-7 h-7 rounded-full bg-primary flex items-center justify-center text-white text-sm ml-2">2</span>
                    المناسبات الإسلامية في حياتك
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="stat-card card-item bg-gradient-to-br from-amber-50 to-yellow-50 dark:from-gray-700 dark:to-gray-800 p-4 rounded-xl shadow-sm">
                        <h4 class="text-amber-600 dark:text-amber-300 font-bold mb-3">شهر رمضان</h4>
                        <div class="flex items-end justify-between">
                            <div>
                                <span id="ramadanCount" class="text-3xl font-bold"></span>
                                <span class="text-gray-600 dark:text-gray-400">شهر</span>
                            </div>
                            <div class="text-right">
                                <span id="fastingDays" class="text-3xl font-bold"></span>
                                <span class="text-gray-600 dark:text-gray-400">يوم صيام</span>
                            </div>
                        </div>
                        <div class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                            <p>سنوات الصيام: <span id="ramadanYears" class="font-medium"></span></p>
                        </div>
                    </div>
                    <div class="stat-card card-item bg-gradient-to-br from-emerald-50 to-green-50 dark:from-gray-700 dark:to-gray-800 p-4 rounded-xl shadow-sm">
                        <h4 class="text-emerald-600 dark:text-emerald-300 font-bold mb-3">عيد الفطر</h4>
                        <div class="flex items-end">
                            <span id="eidFitrCount" class="text-3xl font-bold"></span>
                            <span class="text-gray-600 dark:text-gray-400 mr-1 mb-1">عيد</span>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400">(منذ سن التكليف)</p>
                    </div>
                    <div class="stat-card card-item bg-gradient-to-br from-red-50 to-rose-50 dark:from-gray-700 dark:to-gray-800 p-4 rounded-xl shadow-sm">
                        <h4 class="text-red-600 dark:text-red-300 font-bold mb-3">عيد الأضحى</h4>
                        <div class="flex items-end">
                            <span id="eidAdhaCount" class="text-3xl font-bold"></span>
                            <span class="text-gray-600 dark:text-gray-400 mr-1 mb-1">عيد</span>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400">(منذ سن التكليف)</p>
                    </div>
                </div>
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <span class="w-7 h-7 rounded-full bg-primary flex items-center justify-center text-white text-sm ml-2">3</span>
                    بطولات فريقك المفضل
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="stat-card card-item bg-gradient-to-br from-sky-50 to-blue-50 dark:from-gray-700 dark:to-gray-800 p-4 rounded-xl shadow-sm">
                        <h4 class="text-sky-600 dark:text-sky-300 font-bold mb-3">البطولات الإجمالية</h4>
                        <div class="flex items-end mb-2">
                            <span id="totalTitles" class="text-3xl font-bold"></span>
                            <span class="text-gray-600 dark:text-gray-400 mr-1 mb-1">بطولة</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">
                            <div id="allTitlesList"></div>
                        </div>
                    </div>
                    <div class="stat-card card-item bg-gradient-to-br from-indigo-50 to-violet-50 dark:from-gray-700 dark:to-gray-800 p-4 rounded-xl shadow-sm">
                        <h4 class="text-indigo-600 dark:text-indigo-300 font-bold mb-3">البطولات في حياتك</h4>
                        <div class="flex items-end mb-2">
                            <span id="titlesAfterBirth" class="text-3xl font-bold"></span>
                            <span class="text-gray-600 dark:text-gray-400 mr-1 mb-1">بطولة</span>
                        </div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">
                            <div id="filteredTitlesList"></div>
                        </div>
                    </div>
                </div>
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <span class="w-7 h-7 rounded-full bg-primary flex items-center justify-center text-white text-sm ml-2">4</span>
                    أهم حدث في شهر ميلادك
                </h3>
                <div id="events" class="card-item bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-800 p-4 rounded-xl shadow-sm mb-6"></div>
                <div class="flex flex-wrap justify-center gap-3 mt-6">
                    <button id="resetBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                        </svg>
                        إعادة تعيين
                    </button>
                    <button id="darkModeBtn" class="bg-gray-700 dark:bg-gray-300 text-white dark:text-gray-800 font-medium py-2 px-4 rounded-lg transition-colors duration-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-1" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                        </svg>
                        تغيير الوضع
                    </button>
                    <button id="savePdfBtn" class="bg-primary hover:bg-opacity-90 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-300 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 5a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-1.586a1 1 0 01-.707-.293l-1.121-1.121A2 2 0 0011.172 3H8.828a2 2 0 00-1.414.586L6.293 4.707A1 1 0 015.586 5H4zm6 9a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                        </svg>
                        حفظ كملف PDF
                    </button>
                </div>
            </div>
        </div>

        <footer class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-700 text-center text-gray-500 dark:text-gray-400 text-sm">
            <p>جميع الحقوق محفوظة © <span id="currentYear"></span></p>
            <p class="mt-1">تم التطوير بواسطة <span class="font-bold text-primary">علي عبدالله بكري</span></p>
        </footer>
    </div>

    <script>
        let userData = null;
        const currentDate = new Date('2025-03-11');

        const teamTitles = {
            "الهلال": {
                totalTitles: 69,
                titles: {
                    "الدوري السعودي": [1977, 1979, 1985, 1986, 1988, 1990, 1993, 1996, 1998, 2002, 2005, 2008, 2010, 2011, 2017, 2020, 2021, 2023],
                    "كأس الملك": [1961, 1964, 1980, 1982, 1984, 1989, 2015, 2017, 2020, 2023],
                    "دوري أبطال آسيا": [1991, 1999, 2000, 2019],
                    "كأس السوبر": [2015, 2018, 2021]
                }
            },
            "النصر": {
                totalTitles: 28,
                titles: {
                    "الدوري السعودي": [1976, 1980, 1981, 1989, 1994, 1995, 2014, 2015, 2019, 2020, 2023],
                    "كأس الملك": [1974, 1976, 1981, 1986, 1987, 1990, 2014, 2020],
                    "دوري أبطال آسيا": [1995],
                    "كأس السوبر": [2019, 2020]
                }
            },
            "الاتحاد": {
                totalTitles: 38,
                titles: {
                    "الدوري السعودي": [1982, 1997, 1999, 2000, 2001, 2003, 2007, 2009, 2022, 2023],
                    "كأس الملك": [1958, 1959, 1960, 1963, 1967, 1988, 2010, 2013, 2018],
                    "دوري أبطال آسيا": [2004, 2005],
                    "كأس السوبر": [2013, 2014]
                }
            },
            "الأهلي": {
                totalTitles: 34,
                titles: {
                    "الدوري السعودي": [1978, 1984, 2016],
                    "كأس الملك": [1962, 1965, 1969, 1970, 1971, 1972, 1973, 1978, 1979, 1983, 2011, 2012, 2016],
                    "دوري أبطال آسيا": [],
                    "كأس السوبر": [2016]
                }
            }
        };

        const monthlyEvents = {
            1: [
                "تأسيس المملكة العربية السعودية (1727)",
                "بداية التقويم الهجري (622م)",
                "انتهاء حرب الخليج الثانية (1991)",
                "تأسيس منظمة التجارة العالمية (1995)",
                "اختراع الهاتف (1876)",
                "افتتاح برج خليفة (2010)",
                "ثورة يناير في مصر (2011)",
                "هبوط الإنسان على القمر (1969)",
                "تأسيس جامعة الملك سعود (1957)",
                "إطلاق أول قمر صناعي (1957)"
            ],
            // ... بيانات الأشهر الأخرى بنفس الهيكل
        };

        function initDarkMode() {
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) document.documentElement.classList.add('dark');
            else document.documentElement.classList.remove('dark');
        }

        function toggleDarkMode() {
            const isDarkMode = document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', isDarkMode);
        }

        function populateDateSelects() {
            const hijriDaySelect = document.getElementById("hijriDay");
            const hijriYearSelect = document.getElementById("hijriYear");

            for (let i = 1; i <= 30; i++) {
                const option = document.createElement("option");
                option.value = i;
                option.textContent = i;
                hijriDaySelect.appendChild(option);
            }

            const currentHijriYear = Math.floor((currentDate.getFullYear() - 622) * (33 / 32));
            const startHijriYear = currentHijriYear - 80;

            for (let i = currentHijriYear; i >= startHijriYear; i--) {
                const option = document.createElement("option");
                option.value = i;
                option.textContent = i;
                hijriYearSelect.appendChild(option);
            }
        }

        function hijriToGregorian(hijriYear, hijriMonth, hijriDay) {
            const jd = Math.floor((11 * hijriYear + 3) / 30) + 354 * hijriYear + 30 * hijriMonth - Math.floor((hijriMonth - 1) / 2) + hijriDay + 1948440 - 385;
            return new Date((jd - 2440588) * 86400000);
        }

        function calculateGregorianAge(birthDateGreg) {
            const diffMs = currentDate - birthDateGreg;
            const ageDate = new Date(diffMs);
            const years = Math.abs(ageDate.getUTCFullYear() - 1970);
            const months = ageDate.getUTCMonth();
            const days = ageDate.getUTCDate() - 1;
            return { years, months, days };
        }

        function calculateHijriAge(birthHijriYear, birthHijriMonth, birthHijriDay) {
            const currentHijriYear = Math.floor((currentDate.getFullYear() - 622) * (33 / 32));
            const currentHijriMonth = Math.floor((currentDate.getMonth() + 1) * (12 / 12));
            const currentHijriDay = currentDate.getDate();

            let years = currentHijriYear - birthHijriYear;
            let months = currentHijriMonth - birthHijriMonth;
            let days = currentHijriDay - birthHijriDay;

            if (days < 0) {
                months--;
                days += 30;
            }
            if (months < 0) {
                years--;
                months += 12;
            }
            return { years, months, days };
        }

        function countIslamicEvents(birthHijriYear, birthHijriMonth) {
            const currentHijriYear = Math.floor((currentDate.getFullYear() - 622) * (33 / 32));
            const takleefYear = birthHijriYear + 10;
            let ramadanCount = 0;
            let fastingDays = 0;
            const ramadanYears = [];

            for (let year = takleefYear; year <= currentHijriYear; year++) {
                if (year > birthHijriYear || birthHijriMonth <= 9) {
                    ramadanCount++;
                    fastingDays += 30; // تقريبًا
                    ramadanYears.push(year);
                }
            }

            return { ramadanCount, fastingDays, ramadanYears: ramadanYears.join('، ') };
        }

        function fetchTeamData(team, birthYear) {
            const teamData = teamTitles[team] || { totalTitles: 0, titles: {} };
            let titlesAfterBirth = 0;
            const filteredTitles = {};

            Object.entries(teamData.titles).forEach(([title, years]) => {
                const filtered = years.filter(year => year >= birthYear);
                titlesAfterBirth += filtered.length;
                if (filtered.length > 0) filteredTitles[title] = filtered;
            });

            return {
                totalTitles: teamData.totalTitles,
                titlesAfterBirth,
                allTitles: teamData.titles,
                filteredTitles
            };
        }

        function formatTitles(titles) {
            return Object.entries(titles).map(([title, years]) => `
                <div class="mb-3 border-b pb-2 border-gray-200 dark:border-gray-600">
                    <p class="font-medium text-primary dark:text-blue-300">${title}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${years.join(' - ')}</p>
                </div>
            `).join('');
        }

        async function displayUserInfo() {
            if (!userData) return;

            document.getElementById("formContainer").classList.add("hidden");
            document.getElementById("infoContainer").classList.remove("hidden");
            document.getElementById("loadingState").classList.remove("hidden");
            document.getElementById("dashboard").classList.add("hidden");

            const { name, hijriDate, team } = userData;
            const [hijriDay, hijriMonth, hijriYear] = hijriDate.split('-').map(Number);
            const birthDateGreg = hijriToGregorian(hijriYear, hijriMonth, hijriDay);
            const gregorianAge = calculateGregorianAge(birthDateGreg);
            const hijriAge = calculateHijriAge(hijriYear, hijriMonth, hijriDay);
            const islamicEvents = countIslamicEvents(hijriYear, hijriMonth);
            const teamData = fetchTeamData(team, birthDateGreg.getFullYear());
            const event = fetchMonthlyEvent(birthDateGreg.getMonth() + 1);

            document.getElementById("userInitials").textContent = name.split(' ').map(n => n[0]).join('').substring(0, 2);
            document.getElementById("userName").textContent = name;
            document.getElementById("userBirthDate").textContent = `تاريخ الميلاد الهجري: ${hijriDay}/${hijriMonth}/${hijriYear}`;
            document.getElementById("gregorianAge").textContent = gregorianAge.years;
            document.getElementById("gregorianMonths").textContent = gregorianAge.months;
            document.getElementById("gregorianDays").textContent = gregorianAge.days;
            document.getElementById("hijriAge").textContent = hijriAge.years;
            document.getElementById("hijriMonths").textContent = hijriAge.months;
            document.getElementById("hijriDays").textContent = hijriAge.days;
            document.getElementById("ramadanCount").textContent = islamicEvents.ramadanCount;
            document.getElementById("fastingDays").textContent = islamicEvents.fastingDays;
            document.getElementById("ramadanYears").textContent = islamicEvents.ramadanYears;
            document.getElementById("eidFitrCount").textContent = islamicEvents.eidFitrCount;
            document.getElementById("eidAdhaCount").textContent = islamicEvents.eidAdhaCount;
            document.getElementById("teamInitial").textContent = team[0];
            document.getElementById("teamName").textContent = team;
            document.getElementById("totalTitles").textContent = teamData.totalTitles;
            document.getElementById("titlesAfterBirth").textContent = teamData.titlesAfterBirth;
            document.getElementById("allTitlesList").innerHTML = formatTitles(teamData.allTitles);
            document.getElementById("filteredTitlesList").innerHTML = formatTitles(teamData.filteredTitles);

            document.getElementById("events").innerHTML = `
                <h4 class="text-lg font-bold mb-3">أهم 10 أحداث في شهر ${birthDateGreg.getMonth() + 1}</h4>
                <ol class="list-decimal list-inside space-y-2">
                    ${event.map(e => `<li>${e}</li>`).join('')}
                </ol>
            `;

            setTimeout(() => {
                document.getElementById("loadingState").classList.add("hidden");
                document.getElementById("dashboard").classList.remove("hidden");
            }, 800);
        }

        function initApp() {
            document.getElementById("currentYear").textContent = currentDate.getFullYear();
            populateDateSelects();
            initDarkMode();

            document.getElementById("saveBtn").addEventListener("click", () => {
                const name = document.getElementById("name").value;
                const hijriDay = document.getElementById("hijriDay").value;
                const hijriMonth = document.getElementById("hijriMonth").value;
                const hijriYear = document.getElementById("hijriYear").value;
                const team = document.getElementById("team").value;

                if (!name || !hijriDay || !hijriMonth || !hijriYear || !team) {
                    showError("يرجى ملء جميع الحقول");
                    return;
                }

                userData = { name, hijriDate: `${hijriDay}-${hijriMonth}-${hijriYear}`, team };
                displayUserInfo();
            });

            document.getElementById("resetBtn").addEventListener("click", () => {
                userData = null;
                document.getElementById("name").value = "";
                document.getElementById("hijriDay").value = "";
                document.getElementById("hijriMonth").value = "";
                document.getElementById("hijriYear").value = "";
                document.getElementById("team").value = "";
                document.getElementById("formContainer").classList.remove("hidden");
                document.getElementById("infoContainer").classList.add("hidden");
            });

            document.getElementById("darkModeBtn").addEventListener("click", toggleDarkMode);

            document.getElementById("savePdfBtn").addEventListener("click", () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                const dashboard = document.getElementById("dashboard");
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 10;

                html2canvas(dashboard, {
                    scale: 2,
                    width: dashboard.offsetWidth,
                    height: dashboard.offsetHeight
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = pageWidth - 2 * margin;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    let heightLeft = imgHeight;
                    let position = margin;

                    doc.addImage(imgData, 'PNG', margin, position, imgWidth, imgHeight);
                    heightLeft -= (pageHeight - 2 * margin);

                    while (heightLeft > 0) {
                        doc.addPage();
                        position = heightLeft - imgHeight;
                        doc.addImage(imgData, 'PNG', margin, position, imgWidth, imgHeight);
                        heightLeft -= (pageHeight - 2 * margin);
                    }

                    doc.save("لوحة_المعلومات.pdf");
                }).catch(error => {
                    console.error("خطأ أثناء إنشاء PDF:", error);
                    showError("حدث خطأ أثناء حفظ الملف، حاول مرة أخرى");
                });
            });
        }

        function showError(message) {
            const errorDiv = document.getElementById("errorMessage");
            errorDiv.textContent = message;
            errorDiv.classList.remove("hidden");
            setTimeout(() => errorDiv.classList.add("hidden"), 3000);
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>
